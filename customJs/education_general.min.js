$(document).ready(function () {
    generateRangeNum(1, 40);
    svgGraph = $("#graph");
    drawAxis(svgGraph);
    $("#slider-range").slider({
        range: true,
        min: 1,
        max: 40,
        values: [age_today, age_univ],
        slide: function (b, c) {
            $("#range_num div").hide();
            $("#range_" + c.values[0]).show();
            $("#range_" + c.values[1]).show();
            ageDiff(c.values[0], c.values[1]);
            age_today = c.values[0];
            age_univ = c.values[1]
        }
    });
    $("#range_" + $("#slider-range").slider("values", 0)).show();
    $("#range_" + $("#slider-range").slider("values", 1)).show();
    ageDiff($("#slider-range").slider("values", 0), $("#slider-range").slider("values", 1));
    $("#slider-rate").slider({
        range: false,
        min: 0,
        max: 100,
        value: (return_per_annual * 10),
        slide: function (b, c) {
            $("#rate_num").html((c.value / 10) + "%");
            return_per_annual = c.value / 10
        }
    });
    $("#rate_" + $("#slider-rate").slider("value")).show();
    startGraph();
    $("#front").click(function (b) {
        $("#keypad").hide();
        $("#keypad_pointer").hide()
    });
    $("#keypad").click(function (b) {
        b.stopPropagation()
    });
    var a;
    $("#expected_cost").click(function (b) {
        a = $(this).find(".input");
        $("#keypad").show();
        $("#keypad_pointer").css("top", "232px").show();
        b.stopPropagation()
    });
    $("#current_saving").click(function (b) {
        a = $(this).find(".input");
        $("#keypad").show();
        $("#keypad_pointer").css("top", "286px").show();
        b.stopPropagation()
    });
    $("#monthly_saving").click(function (b) {
        a = $(this).find(".input");
        $("#keypad").show();
        $("#keypad_pointer").css("top", "339px").show();
        b.stopPropagation()
    });
    $("#calculate_btn").click(function () {
        startGraph()
    });
	
	$("#recalculate").click(function () {
		
		total_cost = removeFormat($("0").html());
    	current_saving = removeFormat($("0").html());
   		monthly_saving = removeFormat($("0").html());
		maxVal = removeFormat($("0").html());
		
    	datas = generateDatas();
    	drawGraphData(datas, age_today);
		
		total_cost = formatNumber(Math.round(total_cost), 0);
		current_saving = formatNumber(Math.round(current_saving), 0);
		monthly_saving = formatNumber(Math.round(monthly_saving), 0);
		maxVal = formatNumber(Math.round(maxVal), 0);
    	var b = total_cost;
		var c = current_saving;
		var d = monthly_saving;
		var e = "$ " + maxVal;
		$("#expected_cost .input").html(b);
		$("#current_saving .input").html(c);
		$("#monthly_saving .input").html(d);
		
		$("#maxValueGraph").html(e);
		
    });
	
    $("#keypad .btn").click(function (d) {
        var b = $(this).html();
        if (b == "Go") {
            if (a.parent().attr("id") == "expected_cost") {
                $("#current_saving").click()
            } else {
                if (a.parent().attr("id") == "current_saving") {
                    $("#monthly_saving").click()
                } else {
                    $("#front").click()
                }
            }
        } else {
            if (!isNaN(parseInt(b))) {
                var c = removeFormat(a.html()) + "";
                if (c.length == 9) {
                    return
                }
                c = c + b;
                a.html(formatNumber(c, 0))
            } else {
                var c = removeFormat(a.html()) + "";
                c = c.substr(0, c.length - 1);
                a.html(formatNumber(c, 0))
            }
        }
    });
    $(".help_box .close_btn").click(function () {
        $(".help_box").hide()
    });
    $("#q1_help").click(function () {
        $(".help_box").hide();
        $("#quick_help1").show()
    });
    $("#q2_help").click(function () {
        $(".help_box").hide();
        $("#quick_help2").show()
    });
    $("#q3_help").click(function () {
        $(".help_box").hide();
        $("#quick_help3").show()
    });
    $("#q4_help").click(function () {
        $(".help_box").hide();
        $("#quick_help4").show()
    });
    $("#important_notes").click(function () {
        $(".help_box").hide();
        $("#quick_help5").show()
    })
	
	 $("#explain_help").click(function () {
        $(".help_box").hide();
        $("#quick_explain").show()
    })
	
	$("#table_cost").click(function () {
		//alert("show shit");
        $(".help_box").hide();
        $("#quick_table").show()
    })
});

function startGraph() {
    total_cost = removeFormat($("#expected_cost .input").html());
    current_saving = removeFormat($("#current_saving .input").html());
    monthly_saving = removeFormat($("#monthly_saving .input").html());
    datas = generateDatas();
    drawGraphData(datas, age_today);
    var a = calculateAdditionalSavingNeeded();
    if (a > 0) {
        $("#additional_save").html(formatNumber(a, 0));
        $("#bottom table td.needMoreSave").show();
        $("#bottom table td.enoughSave").hide()
    } else {
        $("#bottom table td.needMoreSave").hide();
        $("#bottom table td.enoughSave").show()
    }
}function generateRangeNum(d, a) {
    var b = 9.3;
    var f = 0;
    for (var c = d; c <= a; c++) {
        $("#range_num").append('<div id="range_' + c + '" class="num">' + c + "</div>");
        var e = f * b;
        f++;
        $("#range_num #range_" + c).css("left", e + "px")
    }
}function generateRateNum(d, a) {
    var b = 1.05;
    var f = 0;
    for (var c = d; c <= (a * 10); c++) {
        $("#rate_num").append('<div id="rate_' + c + '" class="num">' + (c / 10) + "%</div>");
        var e = f * b;
        f++;
        $("#rate_num #rate_" + c).css("left", e + "px")
    }
}function ageDiff(b, a) {
    var c = a - b;
    $("#age_diff").html(c)
}function formatNumber(c, b) {
    var f = c % 1;
    var a = Math.round(f * Math.pow(10, b));
    var d = (c - f) + "";
    var h = "";
    var g = 0;
    for (var e = d.length - 1; e >= 0; e--) {
        if (g == 3) {
            h = d.charAt(e) + "," + h;
            g = 1
        } else {
            h = d.charAt(e) + h;
            g++
        }
    }
    if (b == 0) {
        return h
    }
    return h + "." + a
};